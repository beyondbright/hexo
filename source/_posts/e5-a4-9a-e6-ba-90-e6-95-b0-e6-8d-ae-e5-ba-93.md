---
title: 多源数据库
id: 227
categories:
  - 日记
date: 2013-05-04 15:44:10
tags:
---

搞了好几天了，深感dba不好当啊……

需求：将多个oracle数据源的数据整合在一起显示给用户，考虑实时性、并发性。

思考：

1、用dblink将多数据源整成一个，做一张view用union将需要的数据搞在一起，应用程序从view读取数据。这样产生的问题：dblink远程数据库使之产生session不能消掉，这个很可怕，多几个用户，多点几下查询就把远程数据库给搞挂了！还有每次都用view去union数据效率并不高，万一某个源挂了呢？

2、用物化视图代替view。由于需求是实时性，所以定时刷新就别考虑了，本想用commit进行增量刷新，但物化视图的commit增量刷新需要视图日志而且限制很多，加上view很复杂，关联了十来张表（各个源都有），改动量略大，这么多视图日志做触发侦听，资源消耗上也不确定。

暂时方案：

使用物化视图，用存储过程手动进行完全刷新（在刷新前判断物化视图是否正在刷新中），刷新后关闭dblink连接。该方案待验证中……

ps：建了一张表来判断物化视图是否在刷新中，本想用oracle管道和job定时来做，但经测试这样并没有实现并行刷新。因时间问题只能暂时验证这个方案先，到时候再研究研究……